{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://archon72.com/schemas/execution-plan.v1.json",
  "title": "Execution Plan",
  "description": "Transforms ratified intent (WHAT) into executable plans (HOW) without altering meaning. Owned by one President, with contributions from all affected Portfolios.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "execution_plan_id",
    "version",
    "motion_id",
    "plan_owner",
    "portfolio_contributions",
    "no_action_attestations",
    "capacity_claims",
    "status",
    "created_at"
  ],
  "properties": {
    "execution_plan_id": {
      "type": "string",
      "description": "Unique identifier for this execution plan (UUID).",
      "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
    },
    "version": {
      "type": "string",
      "const": "1.0.0"
    },
    "motion_id": {
      "type": "string",
      "description": "Reference to the ratified motion this plan executes."
    },
    "motion_title": {
      "type": "string",
      "description": "Title of the ratified motion for reference."
    },
    "plan_owner": {
      "type": "object",
      "description": "The President who owns this plan. Ownership implies accountability, not supremacy.",
      "additionalProperties": false,
      "required": ["president_id", "president_name", "portfolio"],
      "properties": {
        "president_id": {
          "type": "string"
        },
        "president_name": {
          "$ref": "#/$defs/president_name"
        },
        "portfolio": {
          "$ref": "#/$defs/portfolio"
        }
      }
    },
    "affected_portfolios": {
      "type": "array",
      "description": "All portfolios that must either contribute or attest no-action.",
      "items": {
        "$ref": "#/$defs/portfolio"
      }
    },
    "portfolio_contributions": {
      "type": "array",
      "description": "Contributions from each affected portfolio. Only the owning President may contribute.",
      "items": {
        "$ref": "#/$defs/portfolio_contribution"
      }
    },
    "no_action_attestations": {
      "type": "array",
      "description": "Attestations from portfolios that are affected but require no work.",
      "items": {
        "$ref": "#/$defs/no_action_attestation"
      }
    },
    "integrated_tasks": {
      "type": "array",
      "description": "All tasks from all contributions, integrated into execution order.",
      "items": {
        "$ref": "#/$defs/task"
      }
    },
    "capacity_claims": {
      "type": "object",
      "description": "Explicit capacity requirements. Plans may be valid but deferred due to capacity.",
      "additionalProperties": false,
      "required": ["clusters_required", "program_slots_required"],
      "properties": {
        "clusters_required": {
          "type": "array",
          "description": "Clusters needed for execution.",
          "items": {
            "type": "object",
            "properties": {
              "cluster_id": { "type": "string" },
              "cluster_name": { "type": "string" },
              "capacity_units": { "type": "integer", "minimum": 1 }
            }
          }
        },
        "program_slots_required": {
          "type": "integer",
          "description": "Number of program slots this plan requires.",
          "minimum": 1
        },
        "time_estimate": {
          "type": "string",
          "description": "ISO-8601 duration estimate. Not a commitment."
        },
        "risk_if_unavailable": {
          "type": "string",
          "description": "What happens if capacity cannot be obtained.",
          "maxLength": 1000
        }
      }
    },
    "blockers": {
      "type": "array",
      "description": "Conditions that prevent execution. Critical blockers must be escalated to Conclave.",
      "items": {
        "$ref": "#/$defs/blocker"
      }
    },
    "constraints_from_motion": {
      "type": "array",
      "description": "Constraints inherited from the ratified motion that this plan must honor.",
      "items": {
        "type": "string"
      }
    },
    "success_criteria_mapping": {
      "type": "array",
      "description": "How plan tasks map to motion success criteria.",
      "items": {
        "type": "object",
        "properties": {
          "motion_criterion": { "type": "string" },
          "addressed_by_tasks": {
            "type": "array",
            "items": { "type": "string" }
          }
        }
      }
    },
    "advisory_acknowledgments": {
      "type": "array",
      "description": "Acknowledgment of relevant Marquis advisories.",
      "items": {
        "type": "object",
        "properties": {
          "advisory_id": { "type": "string" },
          "marquis_id": { "type": "string" },
          "acknowledged": { "type": "boolean" },
          "response": {
            "type": "string",
            "enum": ["accepted", "rejected_with_rationale", "not_applicable"]
          },
          "rationale": { "type": "string" }
        }
      }
    },
    "status": {
      "type": "string",
      "enum": [
        "draft",
        "collecting_contributions",
        "integrating",
        "submitted",
        "authorized",
        "executing",
        "completed",
        "blocked",
        "deferred",
        "rejected"
      ]
    },
    "created_at": {
      "type": "string",
      "format": "date-time"
    },
    "submitted_at": {
      "type": "string",
      "format": "date-time"
    },
    "authorized_at": {
      "type": "string",
      "format": "date-time"
    },
    "handoff": {
      "type": "object",
      "description": "Record of handoff to Administration. After handoff, President steps back.",
      "additionalProperties": false,
      "properties": {
        "handed_off": {
          "type": "boolean"
        },
        "handed_off_at": {
          "type": "string",
          "format": "date-time"
        },
        "assigned_duke": {
          "type": "object",
          "properties": {
            "duke_id": { "type": "string" },
            "duke_name": { "type": "string" }
          }
        },
        "program_id": {
          "type": "string",
          "description": "Reference to the program created for execution."
        }
      }
    },
    "completion": {
      "type": "object",
      "description": "Record of plan completion.",
      "additionalProperties": false,
      "properties": {
        "completed": { "type": "boolean" },
        "completed_at": {
          "type": "string",
          "format": "date-time"
        },
        "success_criteria_met": {
          "type": "array",
          "items": { "type": "string" }
        },
        "success_criteria_not_met": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "constraints_metadata": {
      "type": "object",
      "description": "Constitutional constraints on execution plans.",
      "additionalProperties": false,
      "properties": {
        "must_preserve_intent": {
          "type": "boolean",
          "const": true
        },
        "must_have_all_portfolio_responses": {
          "type": "boolean",
          "const": true
        },
        "must_escalate_critical_blockers": {
          "type": "boolean",
          "const": true
        },
        "president_authority_ends_at_handoff": {
          "type": "boolean",
          "const": true
        },
        "no_capacity_concealment": {
          "type": "boolean",
          "const": true
        }
      }
    },
    "audit": {
      "type": "object",
      "additionalProperties": false,
      "required": ["created_at", "trace_id"],
      "properties": {
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time"
        },
        "trace_id": {
          "type": "string"
        }
      }
    }
  },
  "$defs": {
    "portfolio": {
      "type": "string",
      "enum": [
        "knowledge_systems_transfer",
        "infrastructure_build_systems",
        "technical_solutions_remediation",
        "wellness_recovery_constraints",
        "ethics_method_compliance",
        "behavioral_intelligence_signals",
        "transformation_pipelines",
        "forecasting_timing_cadence",
        "resource_discovery_capacity",
        "identity_access_perception",
        "adversarial_testing_stress_simulation"
      ],
      "description": "The eleven Executive Portfolios."
    },
    "president_name": {
      "type": "string",
      "enum": [
        "Gaap",
        "Malphas",
        "Marbas",
        "Buer",
        "Foras",
        "Caim",
        "Haagenti",
        "Amy",
        "Valac",
        "Ose",
        "Glasya-Labolas"
      ],
      "description": "The eleven Presidents."
    },
    "president_reference": {
      "type": "object",
      "additionalProperties": false,
      "required": ["president_id", "president_name"],
      "properties": {
        "president_id": {
          "type": "string"
        },
        "president_name": {
          "$ref": "#/$defs/president_name"
        }
      }
    },
    "portfolio_contribution": {
      "type": "object",
      "description": "Contribution from a single portfolio. Only the owning President may contribute.",
      "additionalProperties": false,
      "required": [
        "contribution_id",
        "portfolio",
        "contributing_president",
        "tasks",
        "constraints_respected",
        "attestation"
      ],
      "properties": {
        "contribution_id": {
          "type": "string"
        },
        "portfolio": {
          "$ref": "#/$defs/portfolio"
        },
        "contributing_president": {
          "$ref": "#/$defs/president_reference"
        },
        "tasks": {
          "type": "array",
          "description": "Tasks this portfolio contributes to the plan.",
          "items": {
            "$ref": "#/$defs/task"
          }
        },
        "constraints_respected": {
          "type": "array",
          "description": "Motion constraints this contribution honors.",
          "items": {
            "type": "string"
          }
        },
        "risks": {
          "type": "array",
          "description": "Identified risks within this portfolio's scope.",
          "items": {
            "type": "string"
          }
        },
        "attestation": {
          "type": "object",
          "required": ["attested", "attested_at", "attestation_type"],
          "properties": {
            "attested": { "type": "boolean" },
            "attested_at": {
              "type": "string",
              "format": "date-time"
            },
            "attestation_type": {
              "type": "string",
              "const": "contribution"
            }
          }
        }
      }
    },
    "no_action_attestation": {
      "type": "object",
      "description": "Attestation that a portfolio is affected but requires no work. Silence is not allowed.",
      "additionalProperties": false,
      "required": [
        "attestation_id",
        "portfolio",
        "attesting_president",
        "reason",
        "attestation"
      ],
      "properties": {
        "attestation_id": {
          "type": "string"
        },
        "portfolio": {
          "$ref": "#/$defs/portfolio"
        },
        "attesting_president": {
          "$ref": "#/$defs/president_reference"
        },
        "reason": {
          "type": "string",
          "description": "Why no work is required from this portfolio.",
          "minLength": 10,
          "maxLength": 1000
        },
        "attestation": {
          "type": "object",
          "required": ["attested", "attested_at", "attestation_type"],
          "properties": {
            "attested": { "type": "boolean" },
            "attested_at": {
              "type": "string",
              "format": "date-time"
            },
            "attestation_type": {
              "type": "string",
              "const": "no_action"
            }
          }
        }
      }
    },
    "task": {
      "type": "object",
      "description": "A unit of work within the execution plan.",
      "additionalProperties": false,
      "required": ["task_id", "description", "contributing_portfolio"],
      "properties": {
        "task_id": {
          "type": "string"
        },
        "description": {
          "type": "string",
          "description": "What this task accomplishes.",
          "maxLength": 500
        },
        "contributing_portfolio": {
          "$ref": "#/$defs/portfolio"
        },
        "dependencies": {
          "type": "array",
          "description": "Task IDs this task depends on.",
          "items": {
            "type": "string"
          }
        },
        "sequence_order": {
          "type": "integer",
          "description": "Order in execution sequence.",
          "minimum": 1
        },
        "capacity_required": {
          "type": "object",
          "properties": {
            "cluster_id": { "type": "string" },
            "capacity_units": { "type": "integer", "minimum": 1 }
          }
        },
        "estimated_duration": {
          "type": "string",
          "description": "ISO-8601 duration estimate."
        }
      }
    },
    "blocker": {
      "type": "object",
      "description": "A condition preventing execution. Critical blockers must be escalated.",
      "additionalProperties": false,
      "required": [
        "blocker_id",
        "blocker_type",
        "description",
        "severity",
        "raised_by",
        "raised_at"
      ],
      "properties": {
        "blocker_id": {
          "type": "string"
        },
        "blocker_type": {
          "type": "string",
          "enum": [
            "authority_missing",
            "constraint_conflict",
            "capacity_unavailable",
            "requirements_ambiguous",
            "dependency_blocked",
            "portfolio_conflict"
          ]
        },
        "description": {
          "type": "string",
          "description": "What is blocking execution.",
          "maxLength": 1000
        },
        "severity": {
          "type": "string",
          "enum": ["critical", "major", "minor"],
          "description": "Critical blockers must be escalated to Conclave."
        },
        "raised_by": {
          "$ref": "#/$defs/president_reference"
        },
        "raised_at": {
          "type": "string",
          "format": "date-time"
        },
        "escalated_to_conclave": {
          "type": "boolean",
          "description": "Required for critical blockers."
        },
        "escalated_at": {
          "type": "string",
          "format": "date-time"
        },
        "resolution": {
          "type": "object",
          "properties": {
            "resolved": { "type": "boolean" },
            "resolved_at": {
              "type": "string",
              "format": "date-time"
            },
            "resolution_method": {
              "type": "string",
              "enum": [
                "conclave_decision",
                "capacity_obtained",
                "constraint_clarified",
                "authority_granted",
                "plan_modified"
              ]
            },
            "resolution_notes": { "type": "string" }
          }
        }
      }
    }
  }
}
